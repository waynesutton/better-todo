---
name: convex-dashboard-component
overview: Create a reusable Convex dashboard component package that can be published to npm, allowing developers to add real-time statistics dashboards to their Convex apps with both grid and compass-style views.
todos:
  - id: setup-structure
    content: Create component directory structure with convex.config.ts, package.json, and TypeScript configuration
    status: pending
  - id: extract-ui-components
    content: Extract and refactor Dashboard, DashboardGrid, DashboardCompass, and StatCard components from Stats.tsx
    status: pending
  - id: create-backend-functions
    content: Implement generic stat query builder and support for custom function references in component/stats.ts
    status: pending
  - id: extract-css
    content: Extract all .stats-* CSS from global.css, convert to standalone CSS with theme variables
    status: pending
  - id: create-client-wrapper
    content: Implement DashboardClient class with methods for fetching and subscribing to stats
    status: pending
  - id: add-typescript-types
    content: Define and export all TypeScript types for stat definitions, config, and component API
    status: pending
  - id: setup-build-process
    content: Configure TypeScript compilation, component codegen, and package.json exports
    status: pending
  - id: create-test-helpers
    content: Implement test registration function and example tests using convex-test
    status: pending
  - id: write-documentation
    content: Create comprehensive README with installation, usage examples, configuration, theming guide, and API reference
    status: pending
  - id: create-submission-assets
    content: Create LICENSE file (MIT), component thumbnail (400x300px) at .github/component-thumbnail.png, and ensure public GitHub repo setup
    status: pending
---

# Convex Dashboard Component Plan

## Overview

Create a reusable Convex component package (`@convex-dev/dashboard`) that extracts the dashboard functionality from `src/pages/Stats.tsx` into a standalone, configurable component that other developers can install and use in their Convex apps. The component must meet all Convex component submission criteria for inclusion in the official Components directory at [convex.dev/components](https://www.convex.dev/components).

**Submission Requirements:**

- Package name: `@convex-dev/dashboard` (must use @convex-dev/ prefix)
- Repository: Must be public GitHub repository
- License: MIT (recommended, permissive and widely understood)
- Thumbnail: 400x300px PNG or SVG in `.github/component-thumbnail.png`
- README: Must include installation, usage, and API reference
- Category: Will be assigned during submission (likely "Database" or "Backend")

## Component Structure

### 1. Component Directory Structure

```
convex-dashboard-component/
├── component/
│   ├── _generated/           # Generated by Convex (do not commit)
│   ├── convex.config.ts     # Component definition with defineComponent()
│   ├── schema.ts            # Component schema (if needed for internal tables)
│   └── stats.ts             # Generic stat query builder functions
├── src/
│   ├── Dashboard.tsx        # Main React component
│   ├── DashboardGrid.tsx    # Grid view component
│   ├── DashboardCompass.tsx # Compass/dashboard view component
│   ├── StatCard.tsx         # Individual stat card component
│   ├── types.ts             # TypeScript types
│   └── client.ts            # Client wrapper class
├── styles/
│   └── dashboard.css        # Standalone CSS with theme variables
├── test/
│   └── register.ts          # Test helper registration for convex-test
├── .github/
│   └── component-thumbnail.png  # 400x300px thumbnail for directory
├── LICENSE                  # MIT license (required)
├── package.json             # With proper exports and license field
├── tsconfig.json
├── README.md                # Installation, usage, API reference
└── .gitignore
```

### 2. Component Configuration (`component/convex.config.ts`)

**CRITICAL for AI Review (Must Pass All):**

- Must use `defineComponent("dashboard")` from `convex/server`
- Export default component config
- Follow exact Convex component patterns from docs
- Must be discoverable at standard locations (component/convex.config.ts preferred)
- Component must have functions (queries, mutations, or actions)
- All functions must use new syntax: `query({ args: {}, returns: v.xxx(), handler: async (ctx, args) => {...} })`
- All functions must have `returns:` validator (use `v.null()` for void returns)
- Internal functions must use `internalQuery`, `internalMutation`, `internalAction`
- Use `withIndex()` instead of `filter()` in queries
- Indexes must follow `by_field1_and_field2` naming convention
- Proper TypeScript with `Id<"table">` types

### 3. Backend Functions (`component/stats.ts`)

**Option A: Generic Query Builder (Config-based)**

- Create `getStats` query that accepts configuration
- Allow developers to specify table names and field filters
- Support custom aggregation functions
- Return standardized stat format

**Option B: Custom Function Wrapper**

- Provide `createStatsQuery` helper that wraps developer's custom queries
- Accept function reference and transform to component format
- Support both queries and actions

**Implementation:**

- Export both approaches
- Default to config-based for ease of use
- Allow passing custom function references for advanced use

### 4. React Components

**Main Component (`src/Dashboard.tsx`)**

- Accept `component` prop (ComponentApi reference)
- Accept `stats` prop (array of stat definitions)
- Support view mode toggle (grid/dashboard)
- Handle loading states
- Use `useQuery` or `useAction` from Convex React
- Accept optional `getStats` function reference

**Stat Definition Type:**

```typescript
type StatDefinition = {
  key: string;
  title: string;
  icon?: React.ComponentType;
  color?: string;
  description?: string;
  formatValue?: (value: number) => string;
  calculatePercentage?: (value: number, total: number) => string;
};
```

**Grid View (`src/DashboardGrid.tsx`)**

- Extract grid layout from `Stats.tsx` lines 177-230
- Render stat cards in grid
- Support summary section
- Make responsive

**Compass View (`src/DashboardCompass.tsx`)**

- Extract compass layout from `Stats.tsx` lines 232-331
- Render compass-style dashboard
- Support left/center/right layout

**Stat Card (`src/StatCard.tsx`)**

- Extract card component from `Stats.tsx` lines 180-196
- Make reusable and configurable
- Support icon, color, value, description

### 5. Styling (`styles/dashboard.css`)

- Extract all `.stats-*` CSS from `src/styles/global.css` (lines 6861-7226)
- Convert to standalone CSS with CSS variables for theming
- Define theme variables:
  - `--dashboard-bg-primary`
  - `--dashboard-bg-secondary`
  - `--dashboard-text-primary`
  - `--dashboard-text-secondary`
  - `--dashboard-accent`
  - `--dashboard-border-color`
- Support dark/light/tan themes via data attributes
- Make responsive (mobile support)

### 6. Client Wrapper (`src/client.ts`)

- Create `DashboardClient` class following Convex component patterns
- Accept component reference and options
- Provide methods:
  - `getStats()` - fetch stats
  - `subscribeStats()` - real-time subscription
- Support both config-based and custom function approaches

### 7. TypeScript Types (`src/types.ts`)

- Define `StatData` type
- Define `StatDefinition` type
- Define `DashboardConfig` type
- Define `ComponentApi` types
- Export all types for consumers

### 8. Package Configuration

**package.json exports:**

- Main: `./src/Dashboard.tsx` (React component)
- `./convex.config.js` (Convex component config)
- `./_generated/component.js` (ComponentApi types)
- `./styles/dashboard.css` (CSS file)
- `./test` (Test helpers)
- Types: Include TypeScript definitions

**Dependencies:**

- `convex` (peer dependency)
- `react` (peer dependency)
- `lucide-react` (for default icons, optional)
- `@radix-ui/react-icons` (for view toggle icons)

**Dev Dependencies:**

- `typescript`
- `@types/react`
- `convex-test` (for testing)

### 9. Testing (`test/register.ts`)

- Export `register` function for convex-test
- Include schema and modules
- Follow pattern from Convex component docs

### 10. Documentation

**README.md should include:**

- Installation instructions
- Basic usage example
- Configuration options
- Custom stat definitions
- Theming guide
- API reference
- Examples for both config-based and custom function approaches

## Implementation Steps

1. **Setup Component Structure**
   - Create component directory with `convex.config.ts`
   - Initialize component following Convex component template
   - Set up package.json with proper exports

2. **Extract and Refactor UI Components**
   - Extract grid view from `Stats.tsx`
   - Extract compass view from `Stats.tsx`
   - Extract stat card component
   - Make components generic and configurable

3. **Create Backend Functions**
   - Implement generic query builder
   - Support custom function references
   - Add proper TypeScript types

4. **Extract and Refactor CSS**
   - Copy all `.stats-*` styles
   - Convert to CSS variables
   - Make themeable
   - Ensure mobile responsiveness

5. **Create Client Wrapper**
   - Implement `DashboardClient` class
   - Support both configuration approaches
   - Add real-time subscription support

6. **Add TypeScript Types**
   - Define all necessary types
   - Export for consumers
   - Ensure type safety

7. **Setup Build Process**
   - Configure TypeScript compilation
   - Set up component codegen
   - Configure package exports

8. **Create Test Helpers**
   - Implement test registration
   - Add example test
   - Document testing approach

9. **Write Documentation**
   - Create comprehensive README
   - Add usage examples
   - Document theming
   - Include API reference

10. **Prepare for Publishing**
    - Add license
    - Configure npm publishing
    - Create example app (optional)
    - Version appropriately

## Key Design Decisions

- **Flexibility**: Support both config-based and custom function approaches
- **Real-time**: Use Convex queries for automatic real-time updates
- **Theming**: Standalone CSS with variables for easy customization
- **Type Safety**: Full TypeScript support throughout
- **Component Pattern**: Follow Convex component best practices
- **Backwards Compatible**: Allow gradual adoption

## AI Review Compliance Checklist

**Critical Requirements (Must Pass All):**

1. ✅ Has `convex.config.ts` with `defineComponent("dashboard")`
2. ✅ Has component functions (queries, mutations, or actions)
3. ✅ Functions use new syntax: `query({ args: {}, returns: v.xxx(), handler: async (ctx, args) => {...} })`
4. ✅ All functions have `returns:` validator
5. ✅ Uses `v.null()` for void returns

**Non-Critical Requirements (Should Pass):**

6. ✅ Indexes follow `by_field1_and_field2` naming convention (if component has schema)
7. ✅ Uses `withIndex()` instead of `filter()` in queries
8. ✅ Internal functions use `internalQuery`, `internalMutation`, `internalAction`
9. ✅ Has TypeScript with proper `Id<"table">` types
10. ✅ Uses token-based authorization when applicable (if needed)

## Submission Requirements Checklist

**Before Publishing to npm:**

- [ ] Package name: `@convex-dev/dashboard` (must use @convex-dev/ prefix)
- [ ] Repository: Public GitHub repository (required)
- [ ] LICENSE file: MIT license in repo root
- [ ] package.json: Includes `"license": "MIT"` field
- [ ] Thumbnail: 400x300px PNG or SVG at `.github/component-thumbnail.png`
- [ ] README.md: Includes installation, usage, and API reference sections
- [ ] README.md: Includes thumbnail reference: `![Component thumbnail](.github/component-thumbnail.png)`
- [ ] Component functions: All use new syntax with `returns:` validators
- [ ] Component functions: All void returns use `v.null()`
- [ ] TypeScript: Proper types throughout, no `any` types
- [ ] Build process: Component codegen runs before package build
- [ ] Test helpers: Exported at `./test` entry point

**For Submission to convex.dev/components:**

- [ ] npm package published and accessible
- [ ] GitHub repo is public
- [ ] README quality check passes (installation, usage, API reference present)
- [ ] Code follows Convex best practices (verified by AI review)
- [ ] No security red flags
- [ ] Thumbnail uploaded or generated via [convex.link/componentgen](https://convex.link/componentgen)

## Build Process Details

**Component Codegen (Required Before Build):**

1. Run `npx convex codegen --component-dir ./component` to generate component's `_generated/` directory
2. Build the package: `npm run build` (TypeScript compilation)
3. Example app codegen: `npx convex dev --typecheck-components` (if using example app)

**Recommended package.json scripts:**

```json
{
  "scripts": {
    "dev": "npm-run-all --parallel dev:codegen dev:build dev:watch",
    "dev:codegen": "convex codegen --component-dir ./component --watch",
    "dev:build": "tsc --watch",
    "build": "npm run codegen && tsc && npm run build:copy",
    "codegen": "convex codegen --component-dir ./component",
    "build:copy": "copyfiles -u 1 'styles/**/*' 'dist'",
    "prepublishOnly": "npm run build"
  }
}
```

**Ordering:** Component codegen → Build package → Example app codegen (if applicable)

## Files to Reference

- `src/pages/Stats.tsx` - UI implementation to extract
- `convex/stats.ts` - Backend pattern to generalize
- `src/styles/global.css` (lines 6861-7226) - Styles to extract
- [Convex component authoring docs](https://docs.convex.dev/components/authoring)
- [Convex component understanding docs](https://docs.convex.dev/components/understanding)
- [Convex component using docs](https://docs.convex.dev/components/using)
- [Component submission process](prds/components-submission-process.md)
- [How it works - AI review criteria](prds/howitworks.md)
